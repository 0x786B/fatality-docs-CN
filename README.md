> **本文档由第三方编写,可能有错误的地方,不代表官方文档原项目，请以官方文档为准**
> * [官方文档主页](https://lua.fatality.win/)

> **英文原版** by-onionrepo
> * [文档仓库](https://github.com/onionrepo/fatality-docs)
> * [文档主页](https://onionrepo.github.io/fatality-docs/)

> **中文分支** by-0x786B
> * [文档仓库](https://github.com/0x786B/fatality-docs-CN)
> * [文档主页](https://0x786b.github.io/fatality-docs-CN/)
## 前言

欢迎使用我们的API基础脚本。

Fatality的API设计旨在模仿软件的内部结构，为您提供对其子系统的大量控制。一些可能导致不稳定或损坏的功能受到限制。

> **重要提示：** 市场脚本目前未受保护，可能有潜在被dumper的风险。保护措施将很快引入。

## 概念
我们的脚本引擎使用LuaJIT 2.1（带有少量自定义）。它与Lua 5.1完全兼容，并包含一些Lua 5.2的增强功能。

标准库`baselib`、`bit`、`ffi`、`math`、`string`和`table`可用。请注意，`ffi`库**仅**在启用**允许不安全操作**选项时可用。有关更多详细信息，请参阅[官方Lua文档](https://www.lua.org/manual/5.1/)。

如果我们修改了任何标准函数，我们将记录这些更改以保持您的信息同步。

## 概述
在整个API参考中，您会遇到用于描述某个方法或字段的各种标签。

### 标签

[![字段][这是一个必须使用点（.）访问的常规字段。]rw]
[![函数][这是一个必须使用点（.）调用的常规函数。]rw]
[![方法][这是一个方法，也称为函数，但建议使用冒号（:）语法调用（`obj:fn()`）。]rw]
[![构造函数][这是此类型的构造函数定义。您不需要调用任何特定字段，而是必须调用**类型本身**（例如：`vector`具有`__call`，这意味着您应该这样调用：`vector()`）。]rw]
[![只读][这是一个只读字段，您无法更改其值。此限制通常不适用于任何子元素。]r]
[![不安全][此函数仅在启用“允许不安全操作”时存在。]i]

上述列出了所有可能的标签。

* **字段**：表示一个标准字段，其类型会在名称下方说明。

* **函数**：表示一个函数，使用点语法调用（`obj.fn()`）。

* **方法**：表示一个方法，建议使用冒号语法调用（`obj:fn()`）。

* **构造函数**：表示一个构造函数定义，需调用类型本身（例如：`vector`的`__call`，应调用为：`vector()`）。

* **只读**：表示只读项，值不可更改，通常不影响子元素。

* **不安全**：表示仅在启用“允许不安全操作”时可访问。

### 参数和返回值列表
参数和返回值按您必须提供的顺序列出。例如，如果参数显示在第一位，则应将其作为函数的第一个参数传递。对于返回值也是如此：第一个列出的值将放在您声明的第一个变量中，依此类推。

### 类型
某些类型描述中包含特殊符号：

* `type?` 表示该类型可能是`nil`。

* `type<other>` 表示内部方法或字段将使用`other`类型。

* `<other>` 表示该类型将是`other`，或其任何子类型。

## 规则

为了使脚本安全且易于使用，我们采取了许多安全措施。但由于某些特定内容的工作方式，我们无法将其完全安全化。因此，在编写脚本之前，请了解以下几点：

### 关于LUA的控制
您可以替换或覆盖API函数，但您负责维护稳定的行为。如果您遇到默认API中的任何错误（**除了FFI**），请报告这些问题，以便我们可以解决这些问题。

### 关于LUA的安全性
使用FFI为您提供极大的自由度。请记住，任何可能对用户造成伤害的脚本都是被禁止的，并将被移除。尽可能**依赖提供的API**或请求其他功能，如果您需要目前未提供的功能。自定义“脚本加载器”严格禁止。

### 关于LUA的可用性
避免隐藏不相关的UI元素、阻碍用户输入或干扰整体用户体验。任何破坏功能或骚扰用户的脚本都有可能从工作坊中移除。
